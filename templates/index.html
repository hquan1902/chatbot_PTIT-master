<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>ChatBox PTIT</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
  <aside class="sidebar">
    <h2>Lịch sử trò chuyện</h2>
    <div class="history">
      {% for msg in history %}
        <p class="{{ msg.role }}">{{ msg.role }}: {{ msg.text }}</p>
      {% endfor %}
    </div>

    <form id="upload-form">
      <input type="file" id="file" name="file" required>
      <button type="submit">Tải tài liệu</button>
    </form>
  </aside>

  <main class="chat">
    <div id="chat-box"></div>
    <div class="input-area">
      <input type="text" id="user-input" placeholder="Nhập tin nhắn...">
      <button id="send-btn">Gửi</button>
    </div>
  </main>
</div>

<script>
async function sendMessage() {
  const input = document.getElementById('user-input');
  const msg = input.value.trim();
  if (!msg) return;

  const res = await fetch('/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: msg })
  });
  const data = await res.json();

  const box = document.getElementById('chat-box');
  box.innerHTML += `<p class='user'><b>Bạn:</b> ${msg}</p>`;
  box.innerHTML += `<p class='bot'><b>Bot:</b> ${data.reply}</p>`;
  input.value = "";
  box.scrollTop = box.scrollHeight;
}

document.getElementById('send-btn').onclick = sendMessage;
document.getElementById('user-input').addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

document.getElementById('upload-form').onsubmit = async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch('/upload', { method: 'POST', body: formData });
  const data = await res.json();
  alert(data.success ? `Đã tải lên ${data.filename}` : data.error);
};
</script>
</body>
</html>
